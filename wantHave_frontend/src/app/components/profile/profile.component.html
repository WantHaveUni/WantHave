<div class="profile-container">
  @if (loading) {
  <p>Loading...</p>
  }

  @if (error) {
  <p class="error-message">{{ error }}</p>
  }

  <!-- Profile Overview View -->
  @if (profile && currentView === 'overview') {
  <div class="profile-overview">
    <!-- Profile Header -->
    <div class="profile-header-section">
      <div class="profile-picture-container">
        @if (profile.profile_picture) {
        <img [src]="profile.profile_picture" alt="Profile Picture" class="profile-picture">
        } @else {
        <div class="profile-picture-placeholder">üë§</div>
        }
      </div>
      <h2 class="username">{{ profile.user.username }}</h2>
      <a (click)="viewPublicProfile()" class="public-profile-link">View my public profile ‚Ä∫</a>
    </div>

    <!-- Menu Items -->
    <div class="menu-list">
      @for (item of menuItems; track item.id) {
      <button class="menu-item" (click)="navigateTo(item.id)">
        <span class="menu-icon">{{ item.icon }}</span>
        <span class="menu-label">{{ item.label }}</span>
        @if (item.id === 'theme') {
        <span class="theme-value">{{ currentTheme === 'light' ? 'Light' : 'Dark' }}</span>
        }
        <span class="menu-arrow">‚Ä∫</span>
      </button>
      }
    </div>
  </div>
  }

  <!-- My Listings View -->
  @if (profile && currentView === 'listings') {
  <div class="sub-view">
    <div class="sub-view-header">
      <button class="back-button" (click)="goBack()">‚Üê Back</button>
      <h2>My Listings</h2>
    </div>
    @if (listingsLoading) {
    <p>Loading listings...</p>
    } @else if (listings.length === 0) {
    <p class="empty-state">No listings found.</p>
    } @else {
    <div class="listings-grid">
      @for (item of listings; track item.id) {
      <div class="listing-card">
        <div class="listing-content">
          <div class="listing-header">
            <span class="listing-title">{{ item.title }}</span>
            <span class="listing-price">{{ item.price }} ‚Ç¨</span>
          </div>
          <div class="listing-status" [class.sold]="item.status === 'SOLD'">
            {{ item.status }}
          </div>
        </div>
      </div>
      }
    </div>
    }
  </div>
  }

  <!-- Wishlist View -->
  @if (profile && currentView === 'wishlist') {
  <div class="sub-view">
    <div class="sub-view-header">
      <button class="back-button" (click)="goBack()">‚Üê Back</button>
      <h2>Wishlist</h2>
    </div>
    <p class="empty-state">No items in your wishlist yet.</p>
  </div>
  }

  <!-- Search History View -->
  @if (profile && currentView === 'searchHistory') {
  <div class="sub-view">
    <div class="sub-view-header">
      <button class="back-button" (click)="goBack()">‚Üê Back</button>
      <h2>Search History</h2>
    </div>
    <p class="empty-state">No search history available.</p>
  </div>
  }

  <!-- Profile Settings/Edit View -->
  @if (profile && currentView === 'settings') {
  <div class="profile-edit">
    <div class="sub-view-header">
      <button class="back-button" (click)="cancelEdit()">‚úï</button>
      <h2>Edit Profile</h2>
      <button class="save-icon-button" (click)="saveProfile()" [disabled]="saving">‚úì</button>
    </div>

    <!-- Profile Picture Section -->
    <div class="edit-profile-header">
      <div class="profile-picture-container">
        @if (profile.profile_picture) {
        <img [src]="profile.profile_picture" alt="Profile Picture" class="profile-picture">
        } @else {
        <div class="profile-picture-placeholder">üë§</div>
        }
        <label class="camera-button" for="profile_picture">üì∑</label>
        <input type="file" id="profile_picture" (change)="onFileSelected($event)" accept="image/*"
          style="display: none;">
      </div>
      <h2 class="username">{{ profile.user.username }}</h2>
      <a (click)="viewPublicProfile()" class="public-profile-link">View my public profile ‚Ä∫</a>
      @if (selectedFileName) {
      <p class="file-selected">Selected: {{ selectedFileName }}</p>
      }
    </div>

    <form [formGroup]="profileForm" (ngSubmit)="saveProfile()">
      <!-- Public Data Section -->
      <div class="form-section">
        <h3 class="section-title">Public Data</h3>

        <div class="form-row">
          <div class="form-group">
            <label for="first_name">First Name</label>
            <input type="text" id="first_name" formControlName="first_name" placeholder="First Name">
          </div>
          <div class="form-group">
            <label for="last_name">Last Name</label>
            <input type="text" id="last_name" formControlName="last_name" placeholder="Last Name">
          </div>
        </div>

        <div class="form-row">
          <div class="form-group small">
            <label for="postal_code">Postal Code</label>
            <input type="text" id="postal_code" formControlName="postal_code" placeholder="Postal Code">
          </div>
          <div class="form-group">
            <label for="city">City</label>
            <input type="text" id="city" formControlName="city" placeholder="City">
          </div>
        </div>

        <div class="form-group">
          <label for="country">Country</label>
          <select id="country" formControlName="country">
            <option value="">Select Country</option>
            <option value="Austria">Austria</option>
            <option value="Germany">Germany</option>
            <option value="Switzerland">Switzerland</option>
            <option value="Other">Other</option>
          </select>
        </div>
      </div>

      <!-- Private Data Section -->
      <div class="form-section">
        <h3 class="section-title">Private Data <span class="section-subtitle">(only visible to you)</span></h3>

        <div class="form-group with-action">
          <div class="field-with-icon">
            <span class="field-icon">‚úâ</span>
            <span class="field-value">{{ profile.user.email || 'Not set' }}</span>
          </div>
          <button type="button" class="change-button" (click)="changeEmail()">CHANGE</button>
        </div>

        <div class="form-group with-action">
          <div class="field-with-icon">
            <span class="field-icon">üîí</span>
            <span class="field-value">Password</span>
          </div>
          <button type="button" class="change-button" (click)="changePassword()">CHANGE</button>
        </div>

        <div class="form-group with-action">
          <div class="field-with-icon">
            <span class="field-icon">üìû</span>
            <span class="field-value">
              {{ profile.phone || 'Not set' }}
              @if (profile.phone_verified) {
              <span class="verified-badge">(verified)</span>
              }
            </span>
          </div>
          <button type="button" class="change-button" (click)="changePhone()">CHANGE</button>
        </div>

        <div class="form-group">
          <div class="field-with-icon">
            <span class="field-icon">üéÇ</span>
            <input type="number" id="birth_year" formControlName="birth_year" placeholder="Birth Year" min="1900"
              max="2020">
          </div>
        </div>
      </div>

      <!-- Gender Section -->
      <div class="form-section">
        <h3 class="section-title">I am</h3>
        <div class="gender-options">
          <label class="gender-option">
            <input type="radio" formControlName="gender" value="female">
            <span class="gender-label">female</span>
          </label>
          <label class="gender-option">
            <input type="radio" formControlName="gender" value="male">
            <span class="gender-label">male</span>
          </label>
          <label class="gender-option">
            <input type="radio" formControlName="gender" value="diverse">
            <span class="gender-label">diverse</span>
          </label>
          <label class="gender-option">
            <input type="radio" formControlName="gender" value="none">
            <span class="gender-label">none</span>
          </label>
        </div>
      </div>

      <!-- Form Actions -->
      <div class="form-actions">
        <button type="submit" class="save-button" [disabled]="saving || profileForm.invalid">
          {{ saving ? 'Saving...' : 'Save Changes' }}
        </button>
        <button type="button" class="cancel-button" (click)="cancelEdit()" [disabled]="saving">
          Cancel
        </button>
      </div>
    </form>

    <div class="danger-zone">
      <h3>Danger Zone</h3>
      <button type="button" class="delete-button" (click)="deleteAccount()">
        Delete Account
      </button>
    </div>
  </div>
  }
</div>