<div class="chat-container">
    <!-- Sidebar: Conversation List -->
    <div class="chat-sidebar">
        <div class="sidebar-header">
            <h3>Messages</h3>
            <div class="new-chat">
                <input #newChatInput placeholder="User ID"
                    (keyup.enter)="startNewChat(newChatInput.value); newChatInput.value=''">
                <button (click)="startNewChat(newChatInput.value); newChatInput.value=''">+</button>
            </div>
        </div>
        <ul class="conversation-list">
            <li *ngFor="let convo of conversations" [class.active]="convo.id === selectedConversation?.id"
                (click)="selectConversation(convo)">
                <div class="convo-avatar">
                    <!-- Placeholder avatar -->
                    <div class="avatar-circle">{{ convo.participants[0]?.username?.charAt(0) | uppercase }}</div>
                </div>
                <div class="convo-details">
                    <span class="convo-name">
                        <span *ngFor="let p of convo.participants">
                            <span *ngIf="p.id !== currentUser?.id">{{ p.username }}</span>
                        </span>
                    </span>
                    <span class="convo-last-msg" *ngIf="convo.last_message">
                        {{ convo.last_message.content | slice:0:30 }}...
                    </span>
                </div>
            </li>
        </ul>
    </div>

    <!-- Main Chat Window -->
    <div class="chat-window" *ngIf="selectedConversation; else noSelection">
        <div class="chat-header">
            <span *ngFor="let p of selectedConversation.participants">
                <span *ngIf="p.id !== currentUser?.id">{{ p.username }}</span>
            </span>
        </div>

        <div class="messages-area">
            <div *ngFor="let msg of messages" class="message-bubble" [class.sent]="msg.sender.id === currentUser?.id"
                [class.received]="msg.sender.id !== currentUser?.id">
                <div class="message-content">{{ msg.content }}</div>
                <div class="message-time">{{ msg.timestamp | date:'shortTime' }}</div>
            </div>
        </div>

        <div class="chat-input">
            <input [(ngModel)]="newMessage" (keyup.enter)="sendMessage()" placeholder="Type a message..." />
            <button (click)="sendMessage()">Send</button>
        </div>
    </div>

    <ng-template #noSelection>
        <div class="empty-state">
            <p>Select a conversation to start chatting</p>
        </div>
    </ng-template>
</div>